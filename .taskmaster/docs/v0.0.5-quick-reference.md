# Medi v0.0.5 Quick Reference

## Task Overview

| ID | Task | Priority | Complexity | Subtasks | Dependencies |
|----|------|----------|------------|----------|--------------|
| 18 | Expand FHIR Resource Types | High | 7/10 | 6 | None |
| 19 | FHIR Profile Validation | High | 8/10 | 7 | 18 |
| 20 | FHIR Bundle Support | High | 7/10 | 6 | 18 |
| 21 | Compliance Rule Engine | High | 9/10 | 8 | None |
| 22 | Model Registry System | High | 8/10 | 7 | None |
| 23 | Model Calibration | High | 7/10 | 6 | 22 |
| 24 | Advanced Statistics | Medium | 8/10 | 7 | None |
| 25 | Integration Tests | High | 9/10 | 8 | 18-24 |
| 26 | Documentation | Medium | 6/10 | 6 | 18-24 |
| 27 | Version Bump & Release | Medium | 5/10 | 5 | All |

**Total**: 10 tasks, 65 subtasks

## Critical Path

```
Task 18 (FHIR Resources)
  ├─→ Task 19 (Profile Validation)
  └─→ Task 20 (Bundle Support)
        └─→ Task 25 (Integration Tests)
              └─→ Task 26 (Documentation)
                    └─→ Task 27 (Release)

Task 21 (Compliance) ─┐
Task 22 (Model Registry) ─┤
  └─→ Task 23 (Calibration) ─┼─→ Task 25
Task 24 (Statistics) ─────┘
```

## Quick Commands

### View Tasks
```bash
# List all tasks
task-master list

# Show next available task
task-master next

# View specific task details
task-master show 18

# View subtask details
task-master show 18.1
```

### Manage Status
```bash
# Start working on a task
task-master set-status --id=18 --status=in-progress

# Mark subtask complete
task-master set-status --id=18.1 --status=done

# Mark task complete
task-master set-status --id=18 --status=done
```

### Track Progress
```bash
# Log implementation notes
task-master update-subtask --id=18.1 --prompt="Implemented FHIRMedication with validation"

# Update task based on changes
task-master update --from=19 --prompt="Changed validation approach to use profiles"
```

### Testing
```bash
# Test specific crate
cargo test -p medi_data
cargo test -p medi_compliance
cargo test -p medi_stats
cargo test -p medi_ai

# Test all with features
cargo test --all-features

# Run clippy
cargo clippy --all-features -- -D warnings

# Format code
cargo fmt --all
```

## Implementation Phases

### Phase 1: Core Data (7-9 days)
- **Week 1**: Tasks 18, 19, 20
- **Focus**: FHIR resources, validation, bundles
- **Start**: Task 18 (no dependencies)

### Phase 2: Compliance & AI (7-9 days)
- **Week 2**: Tasks 21, 22, 23
- **Focus**: Rule engine, model infrastructure
- **Parallel**: Can work on 21 and 22 simultaneously

### Phase 3: Stats & Testing (4-6 days)
- **Week 3**: Tasks 24, 25
- **Focus**: Advanced statistics, integration tests
- **Note**: Task 25 requires 18-24 complete

### Phase 4: Docs & Release (3 days)
- **Week 3-4**: Tasks 26, 27
- **Focus**: Documentation, version bump, release
- **Final**: Task 27 is last step

## Key Files by Task

### Task 18: FHIR Resources
- `stdlib/medi_data/src/fhir.rs` - Add new resource structs
- `stdlib/medi_data/src/validate.rs` - Add validation functions
- `stdlib/medi_data/tests/` - Add resource tests

### Task 19: Profile Validation
- `stdlib/medi_data/src/validation_profile.rs` - New file
- `stdlib/medi_data/src/validate.rs` - Extend validation
- `stdlib/medi_data/tests/profile_validation.rs` - New tests

### Task 20: Bundle Support
- `stdlib/medi_data/src/bundle.rs` - New file
- `stdlib/medi_data/src/fhir_any.rs` - Extend FHIRAny
- `stdlib/medi_data/tests/bundle.rs` - New tests

### Task 21: Compliance Engine
- `stdlib/medi_compliance/src/engine.rs` - New file
- `stdlib/medi_compliance/src/rules/` - New directory
- `stdlib/medi_compliance/tests/engine.rs` - New tests

### Task 22: Model Registry
- `stdlib/medi_ai/src/registry.rs` - New file
- `stdlib/medi_ai/src/backend.rs` - New file
- `stdlib/medi_ai/tests/registry.rs` - New tests

### Task 23: Model Calibration
- `stdlib/medi_ai/src/calibration.rs` - New file
- `stdlib/medi_ai/src/validation.rs` - Extend existing
- `stdlib/medi_ai/tests/calibration.rs` - New tests

### Task 24: Statistics
- `stdlib/medi_stats/src/streaming.rs` - New file
- `stdlib/medi_stats/src/survival.rs` - New file
- `stdlib/medi_stats/tests/numerical_stability.rs` - New tests

### Task 25: Integration Tests
- `tests/src/integration/` - New directory
- `tests/src/integration/fhir_workflow.rs` - New file
- `tests/src/integration/compliance_workflow.rs` - New file

### Task 26: Documentation
- `stdlib/*/README.md` - Update all
- `stdlib/*/examples/` - Add examples
- `docs/cookbook.md` - New file

### Task 27: Release
- `stdlib/*/Cargo.toml` - Bump versions
- `CHANGELOG.md` - Add v0.0.5 section
- Release notes document

## Success Checklist

### Before Starting
- [x] Tasks parsed and expanded
- [x] Complexity analysis complete
- [x] Implementation plan created
- [ ] Development environment ready

### During Implementation
- [ ] Tests passing for each subtask
- [ ] Code formatted and linted
- [ ] Progress logged in Task Master
- [ ] Documentation updated incrementally

### Before Release
- [ ] All 65 subtasks complete
- [ ] 100% test pass rate
- [ ] Zero clippy warnings
- [ ] All documentation updated
- [ ] Integration tests passing
- [ ] Performance benchmarks met
- [ ] CHANGELOG.md updated
- [ ] Version bumped to 0.2.0
- [ ] Git tag created

## Performance Targets

| Component | Target | Test |
|-----------|--------|------|
| Compliance Engine | 100 rules on 1MB in <100ms | Benchmark |
| Bundle Processing | 1000+ entries efficiently | Load test |
| Streaming Stats | Constant memory | Memory profiler |
| Model Inference | <10ms per prediction | Benchmark |
| Integration Tests | <5s total runtime | CI timing |

## Code Quality Standards

### Testing
- Unit tests for all public functions
- Integration tests for workflows
- Edge case coverage
- Performance benchmarks

### Documentation
- Doc comments on all public items
- Examples in doc comments
- README with getting-started
- Cookbook with patterns

### Code Style
- `cargo fmt` formatting
- `cargo clippy` with `-D warnings`
- Meaningful variable names
- Clear error messages

## Common Patterns

### Adding a New FHIR Resource
```rust
// 1. Define struct in fhir.rs
#[derive(Debug, Clone, Serialize, Deserialize, PartialEq)]
pub struct FHIRMedication {
    pub id: String,
    pub code: String,
    pub form: Option<String>,
}

// 2. Implement FHIRResource trait
impl FHIRResource for FHIRMedication {
    fn resource_type(&self) -> &'static str { "Medication" }
    fn id(&self) -> &str { &self.id }
}

// 3. Add validation in validate.rs
pub fn validate_medication(m: &FHIRMedication) -> Result<(), ValidationError> {
    if m.id.trim().is_empty() {
        return Err(ValidationError::new("Medication.id must not be empty"));
    }
    Ok(())
}

// 4. Add to FHIRAny enum
pub enum FHIRAny {
    Patient(FHIRPatient),
    Observation(FHIRObservation),
    Medication(FHIRMedication), // Add here
}

// 5. Write tests
#[test]
fn test_medication_validation() {
    let med = FHIRMedication { id: "M1".into(), code: "RX123".into(), form: None };
    assert!(validate_medication(&med).is_ok());
}
```

### Adding a Compliance Rule
```rust
// 1. Define rule in rules/
pub fn phi_ssn_rule() -> EnhancedComplianceRule {
    EnhancedComplianceRule {
        id: "hipaa-phi-ssn".into(),
        description: "Detect SSN patterns".into(),
        standard: ComplianceStandard::Hipaa,
        severity: RuleSeverity::Error,
        condition: RuleCondition::MatchesPattern(
            Regex::new(r"\d{3}-\d{2}-\d{4}").unwrap()
        ),
        remediation: Some("Redact or hash SSN values".into()),
    }
}

// 2. Add to default rules
pub fn default_hipaa_rules() -> Vec<EnhancedComplianceRule> {
    vec![
        phi_ssn_rule(),
        // ... other rules
    ]
}

// 3. Test rule
#[test]
fn test_ssn_detection() {
    let engine = ComplianceEngine::new(vec![phi_ssn_rule()]);
    let result = engine.evaluate("Patient SSN: 123-45-6789");
    assert!(!result[0].passed);
}
```

### Adding a Statistical Function
```rust
// 1. Implement function
pub fn kaplan_meier(times: &[f64], events: &[bool]) -> KaplanMeier {
    // Implementation
}

// 2. Add tests
#[test]
fn test_kaplan_meier() {
    let times = vec![1.0, 2.0, 3.0];
    let events = vec![true, false, true];
    let km = kaplan_meier(&times, &events);
    assert_eq!(km.times.len(), 2); // Only event times
}

// 3. Add numerical stability test
#[test]
fn test_kaplan_meier_stability() {
    let times = vec![1e-10, 1e10];
    let events = vec![true, true];
    let km = kaplan_meier(&times, &events);
    assert!(km.survival_prob.iter().all(|p| p.is_finite()));
}
```

## Troubleshooting

### Tests Failing
```bash
# Run specific test
cargo test test_name

# Run with output
cargo test -- --nocapture

# Run single-threaded
cargo test -- --test-threads=1
```

### Clippy Warnings
```bash
# Check specific crate
cargo clippy -p medi_data -- -D warnings

# Fix common issues
cargo clippy --fix
```

### Build Errors
```bash
# Clean and rebuild
cargo clean
cargo build

# Check specific crate
cargo check -p medi_data
```

## Resources

- **Task Master Docs**: `.taskmaster/docs/`
- **Language Spec**: `LANG_SPEC.md`
- **Changelog**: `CHANGELOG.md`
- **Examples**: `examples/`
- **Tests**: `tests/src/`

## Contact

For implementation questions:
1. Review existing code patterns
2. Check Task Master notes
3. Refer to FHIR/HIPAA/GDPR specs
4. Document decisions in task notes

---

**Ready to start?**
```bash
task-master next
task-master show 18
task-master set-status --id=18 --status=in-progress
```
